generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id               Int                @id @default(autoincrement())
  username         String             @unique @default(cuid())
  email            String             @unique
  password         String

  createdAt        DateTime           @default(now())
  updatedAt        DateTime           @updatedAt
  
  is_guest         Boolean            @default(false)
  
  image_url       String
  avatar_id        Int                @default(1)
  avatar           Avatar             @relation(fields: [avatar_id], references: [id])
  learningProgress LearningProgress[]
  presentations    Presentation[]
}

model Avatar {
  id        Int      @id @default(autoincrement())
  image_url String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  users     User[]
}

model Learning {
  id               Int                @id @default(autoincrement())
  title            String
  description      String
  video_url        String
  createdAt        DateTime           @default(now())
  updatedAt        DateTime           @updatedAt
  learningProgress LearningProgress[]
}

model LearningProgress {
  id          Int            @id @default(autoincrement())
  user_id     Int
  learning_id Int
  createdAt   DateTime       @default(now())
  updatedAt   DateTime       @updatedAt
  status      LearningStatus @default(LOCKED)
  learning    Learning       @relation(fields: [learning_id], references: [id])
  user        User           @relation(fields: [user_id], references: [id])
}

model Presentation {
  id        Int                @id @default(autoincrement())
  user_id   Int
  video_url String
  createdAt DateTime           @default(now())
  updatedAt DateTime           @updatedAt
  status    PresentationStatus @default(ONGOING)
  title     String
  feedbacks Feedbacks[]
  user      User               @relation(fields: [user_id], references: [id])
  questions Question[]
}

model Feedbacks {
  id              Int          @id @default(autoincrement())
  presentation_id Int
  intonation      Float
  overall_rating  String
  createdAt       DateTime     @default(now())
  updatedAt       DateTime     @updatedAt
  suggestion      String?
  expression      Float
  posture         Float
  presentation    Presentation @relation(fields: [presentation_id], references: [id])
}

model Question {
  id              Int          @id @default(autoincrement())
  presentation_id Int
  question        String
  createdAt       DateTime     @default(now())
  updatedAt       DateTime     @updatedAt
  answers         Answer[]
  presentation    Presentation @relation(fields: [presentation_id], references: [id])
}

model Answer {
  id          Int      @id @default(autoincrement())
  question_id Int
  answer      String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  question    Question @relation(fields: [question_id], references: [id])
}

enum PresentationStatus {
  ONGOING
  COMPLETED
}

enum LearningStatus {
  LOCKED
  ONPROGRESS
  COMPLETED
}
