generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id            Int            @id @default(autoincrement())
  username      String         @default(cuid()) @unique
  is_guest       Boolean        @default(false)
  email         String         @unique
  password      String
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  presentations Presentation[]
  image_url       String
  avatar_id        Int                @default(1)
  avatar           Avatar             @relation(fields: [avatar_id], references: [id])
  learningProgress LearningProgress[]
}

model Learning{
  id            Int            @id @default(autoincrement())
  title         String
  description   String
  video_url     String
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  

  learningProgress LearningProgress[]
}


model Avatar {
  id        Int      @id @default(autoincrement())
  image_url String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  users     User[]
}

model LearningProgress{
  id            Int            @id @default(autoincrement())
  user_id       Int
  learning_id   Int
  status        LearningStatus @default(LOCKED)
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt

  user          User           @relation(fields: [user_id], references: [id])
  learning      Learning       @relation(fields: [learning_id], references: [id])
}

model Presentation {
  id        Int                @id @default(autoincrement())
  user_id   Int
  video_url String
  createdAt DateTime           @default(now())
  updatedAt DateTime           @updatedAt
  status    PresentationStatus @default(ONGOING)
  title     String
  user      User     @relation(fields: [user_id], references: [id])
  questions      Question[]
  feedbacks Feedbacks[] 
}

model Feedbacks {
  id             Int          @id @default(autoincrement())
  presentation_id Int         
  expression     Float     
  intonation     Float         
  posture        Float
  overall_rating Float
  suggestion      String?
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt

  presentation   Presentation @relation(fields: [presentation_id], references: [id])
}

model Question {
  id             Int          @id @default(autoincrement())
  presentation_id Int         
  question       String
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt

  presentation   Presentation @relation(fields: [presentation_id], references: [id])
  answers        Answer[]
}

model Answer {
  id          Int      @id @default(autoincrement())
  question_id Int   
  audio_url String
  score     Float?
  createdAt   DateTime @default(now())
  question    Question @relation(fields: [question_id], references: [id], onDelete: Cascade)

  @@map("answers")
}
enum PresentationStatus {
  ONGOING
  COMPLETED
  FAILED
}


enum LearningStatus {
  LOCKED
  ONPROGRESS
  COMPLETED
}

// enum UserRole {
//   ADMIN
//   USER
//   GUEST
// }